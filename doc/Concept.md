# **Вступ Kubernetes**

## **Minikube**

site - https://minikube.sigs.k8s.io/
repo - https://github.com/kubernetes/minikube
Основной разработчик: Kubernetes SIG

minikube- інструмент, який дозволяє запустити Kubernetes кластер з однієї ноди у віртуальній машині на вашому персональному комп'ютері.
Minikube також пітримує опцію --driver=none яка дозволяє запускати компоненти Kubernetes на хост системі, ні в віртуальній машині. Використання цього драйвера вимагає Docker та Linux оточення але не гіпервізор.
    - none VM драйвер може привести до проблем з безпекою та втрати даних.
Minikube також підтримує vm-driver=podman схожий на Docker драйвер. Podman запущений як суперюзер (root user) це найкрайщий шлях забезпечити повний доступ ваших контейнерів до будь-якої функції, наявної у вашій системі
    - podman драйвер вимагає запущені контейнери з під root користувача оскільки звичайні облікові записи користувачів не мають повного доступу до всіх функцій операційної системи, які, можливо, потребуватимуть їх роботи.

Великим плюсом minikube є повна документація. Він містить не лише технічні довідники, але й довгий список навчальних посібників для багатьох конкретних випадків використання та сценаріїв розгортання.

З minikube розробник може використовувати практично будь-яку необхідну функцію Kubernetes. Деякі з них потрібно ввімкнути за допомогою позначки –feature-gates. Це набір пар ключ-значення, які описують пропуски функцій для експериментальних функцій. Іншими функціями керує система addons minikube. Додатки можуть бути інтегровані сторонніми постачальниками. 

Я маю лише одну критику щодо minikube: погані можливості автоматизації. Немає файлу конфігурації, який я міг би просто передати в команду, щоб налаштувати весь кластер, як зазначено. Натомість мені потрібно виконувати всі ці команди послідовно. Це дуже шкода, і це можна покращити в майбутньому.




Podman is a utility provided as part of the libpod library. It can be used to create and maintain containers. 

Список архітектур https://github.com/kubernetes/minikube/releases

    - Встановити можна через пакетний менеджер або завантаження.
    - 

Знижена надійність - https://minikube.sigs.k8s.io/docs/drivers/none/#decreased-reliability
Втрата даних - https://minikube.sigs.k8s.io/docs/drivers/none/#data-loss
Проблеми none - https://minikube.sigs.k8s.io/docs/drivers/none/#other

Профілі minikube — це логічні кластери, які можна запускати та зупиняти окремо один від одного. Це дозволяє розробнику мати більше одного середовища розробки на основі Kubernetes. Просто подумайте про кілька роз’єднаних проектів, які вимагають різних версій Kubernetes API, функцій або просто різних робочих навантажень, що виконуються в них. Ви можете запустити:



## **kind**

site - https://kind.sigs.k8s.io/
repo - https://github.com/kubernetes-sigs/kind
Основной разработчик: Kubernetes SIG

Як і k3d, kind також надає можливість використовувати файли конфігурації. Подібно до k3d, ви можете запускати...

Kind — ще один проект, керований Kubernetes SIG. На даний момент я не міг з’ясувати, чому він досі підтримується (я знайшов причину, але читайте далі). Kind — це абревіатура від «Kubernetes у Docker'' і народився з ідеї запустити Kubernetes у середовищі виконання контейнера (замість віртуальної машини). Однак у наш час minikube також вважає за краще використовувати Docker як варіант розгортання, тому більше немає різниці між minikube та kind щодо цього важливого моменту. Однак у своїй документації вони опублікували гарну сторінку, де пояснюються принципи цього виду та цільові випадки використання. Я б сказав, що все зводиться до автоматизації.

Порівняно з minikube, де робота на Podman вважається експериментальною, kind є одним кроком попереду та забезпечує надійну підтримку Podman. Команда проекту навіть доклала серйозних зусиль для запуску kind у режимі rootless. Для тих, кому це може бути важливо, наразі єдиним рішенням є добро. Проте, звичайно, він має кілька обмежень.



kind is a tool for running local Kubernetes clusters using Docker container “nodes”.
kind was primarily designed for testing Kubernetes itself, but may be used for local development or CI.

kind or kubernetes in docker is a suite of tooling for local Kubernetes “clusters” where each “node” is a Docker container. kind is targeted at testing Kubernetes.

можна робити декілька кластерів

Спільнота - https://kind.sigs.k8s.io/#community

## **k3d**

site - https://k3d.io/
repo - https://github.com/rancher/k3d
Основной разработчик: CNCF (Rancher)

Встановлення k3d CLI дуже просте. Ви можете отримати його за допомогою brew, сценарію або завантажити у двійковому вигляді та вручну розмістити на своєму шляху. Однак CLI потребує більше часу, щоб звикнути до нього. Порівняно з minikube, k3d не надає так багато функцій у командному рядку, але ви можете реалізувати майже всі необхідні налаштування з k3d так само добре.




Под каждый узел кластера выделяется свой контейнер плюс ещё один — служебный с nginx, который выполняет роль балансировщика нагрузки. В качестве CNI используется Flannel, а ingress — Traefik. Предусмотрена возможность выбора других CNI — например, в документации есть особые инструкции для Calico и Canal. Поддерживается автодополнение для Bash, zsh, fish, PowerShell.

k3d є більш обмеженим, коли справа доходить до його розгортання на машині розробки. З самого початку k3d підтримував лише локальне середовище виконання контейнера для запуску кластера Kubernetes. Проте, як я вже згадував раніше, завжди можна було керувати кількома окремими кластерами для розробки на одному хості. 

Особливістю k3s є те, що він замінює деякі стандартні компоненти Kubernetes, як-от etcd, на менш масштабовані та менш ресурсомісткі альтернативи (наприклад, SQLite). 

Оскільки k3d — це лише оболонка для k3s, вона може зосередитися на досвіді розробника. Він постачається з дуже хорошою документацією, як і minikube, яка також містить навчальні посібники для певних сценаріїв використання. Наприклад, ви можете знайти приклад робочого циклу розробки за допомогою Tilt та циклу збирання-натискання-тестування за допомогою контейнера k3d можливість обміну зображеннями.

Однією великою перевагою, яку надає k3d (яку на даний момент не має мінікуб), є те, що k3d надає файл конфігурації кластера (починаючи з версії 4.0 .0). 

k3d — це полегшена оболонка для запуску k3s (мінімальний дистрибутив Kubernetes від Rancher Lab) у докері.

Вимоги¶
docker, щоб взагалі мати можливість використовувати k3d
Примітка: для належної роботи k3d v5.x.x потрібен принаймні Docker v20.10.5 (runc >= v1.0.0-rc93) (див. #807< a i=2>)
kubectl для взаємодії з кластером Kubernetes

K3D быстрее, чем Kind, но Kind полностью соответствует стандартам.

Единственная проблема в том, что он не полностью соответствует стандартам K8s, но для локальной разработки это не критично, а для тестовых сред можно использовать другие решения.

висновки:

    - minikube та k3d надають можливість монтувати код із машини розробника безпосередньо до запущеного вузла Kubernetes.
    - Додавання томів після створення та роботи кластера є досі відкритим питанням.

За допомогою команди minikube mount можна точно те саме. Ви навіть можете монтувати томи зберігання після створення кластера. Замість використання PVC Kubernetes ви можете підключитися до коду за допомогою властивості hostPath Pod, що робить його трохи зручнішим

Завантаження зображення локального контейнера

Більш практичним і менш інвазивним підходом до запуску локального коду в minikube, k3d і kind є функція завантаження зображення. Чому менш інвазивні? - Як розробнику, вам не потрібно налаштовувати об’єкти Kubernetes (Pods, PVC тощо) для вашого локального середовища на основі шляхів, які потенційно є унікальними для вашої системи (наприклад, домашні каталоги монтування зазвичай відрізняються для розробників) . Натомість ви робите образ контейнера доступним для свого локального кластера без необхідності спеціального реєстру контейнерів. Це означає, що ви створюєте локальний образ контейнера на основі свого поточного коду (наприклад, docker build . -t myimage) і переносите його безпосередньо в локальний Kubernetes до запустіть його.

Цей підхід використовується майже в усіх наборах інструментів розробки Kubernetes, таких як tilt.dev, devspace< /span> та ін. Слідкуючи за змінами коду, ці інструменти розробки автоматично запускають цикл збирання-завантаження-виконання. Цей підхід повільніший, ніж монтування локального коду за допомогою налаштованого процесу контейнера, але принаймні він (завжди) не змінює об’єкти Kubernetes.

Щоб зробити це з minikube, ви запускаєте...

'minikube image load <name>'

У k3d ви завантажуєте зображення за допомогою...

'k3d image import <name>'

і з добром це...

'kind load docker-image <name>'

...з вашого терміналу.

analysis | kind | k3d  | minikube
--- | --- | --- | ---
Управління створенням/видаленням вузлів | + | + | +
Система управління вузлами | Docker | Docker | virtualbox, vmwarefusion, kvm2, vmware, none, docker, podman, ssh
Система запуску контейнерів | containerd, CRI-O | CRI-O | Docker, CRI-O, containerd
Можливість підключення ФС батьківської ОС | HostPath + docker mount | HostPath + docker mount | HostPath + … (залежить від системи віртуалізації)
швидкість розгортання | + | + | +
стабільність роботи | + | + | +
документація та підтримка | + | + | +
складність налаштування та використання | - | - | +
Популярність | 125,8 тис. зірок на GitHub | 11,1 тис. зірок на GitHub | 4,1 тис. зірок на GitHub